# ADR (Architecture Decision Records) 가이드

## 개념

아키텍처 결정과 그 근거를 기록하는 문서.

**핵심 원칙**:
- 결정은 immutable (변경 X, 새 ADR로 대체)
- "왜"가 가장 중요
- 나중에 "왜 이렇게 했지?" 물음에 답변

---

## ADR 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                       ADR-NNN: Title                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Status: Proposed | Accepted | Deprecated | Superseded          │
│                                                                 │
│  Context                                                        │
│  └── 왜 이 결정이 필요했는가?                                    │
│                                                                 │
│  Options Considered                                             │
│  └── 어떤 선택지가 있었는가?                                     │
│                                                                 │
│  Decision                                                       │
│  └── 무엇을 선택했는가?                                          │
│                                                                 │
│  Rationale                                                      │
│  └── 왜 이것을 선택했는가?                                       │
│                                                                 │
│  Consequences                                                   │
│  └── 이 결정의 결과는? (긍정/부정/중립)                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Status 정의

| Status | 의미 |
|--------|------|
| **Proposed** | 검토 중 |
| **Accepted** | 승인됨, 적용 중 |
| **Deprecated** | 더 이상 권장 X |
| **Superseded by ADR-XXX** | 다른 ADR로 대체됨 |

---

## 작성 가이드

### Context

**무엇을 쓰는가**:
- 결정이 필요한 배경
- 해결해야 할 문제
- 제약 조건

**예시**:
```
에이전트 워크플로우를 관리할 프레임워크가 필요하다.

요구사항:
- 복잡한 멀티스텝 워크플로우 지원
- 상태 관리 및 체크포인팅
- 타입 안전성
```

### Options Considered

**무엇을 쓰는가**:
- 검토한 모든 선택지
- 각 선택지의 장단점

**형식**:
```
| Option | 장점 | 단점 |
|--------|------|------|
| A      | ...  | ...  |
| B      | ...  | ...  |
```

### Decision

**무엇을 쓰는가**:
- 선택한 것 (한 문장)

**예시**:
```
LangGraph 선택
```

### Rationale

**무엇을 쓰는가**:
- 선택 이유 (번호 목록)
- 왜 다른 것은 안 되는지

**예시**:
```
1. 상태 관리가 명시적: TypedDict 기반
2. 체크포인팅 내장: 이어하기 필수
3. 타입 안전성: 코딩 철학과 일치
```

### Consequences

**무엇을 쓰는가**:
- 긍정적 결과
- 부정적 결과 (솔직하게)
- 중립적 결과
- 마이그레이션 경로 (필요 시)

**예시**:
```
긍정적:
- 상태 관리 직접 구현 불필요
- Human-in-the-loop 쉽게 구현

부정적:
- LangChain 의존성 생김
- 러닝커브 존재
```

---

## ADR 작성 시점

다음 결정 시 ADR 작성:

| 유형 | 예시 |
|------|------|
| 프레임워크 선택 | LangGraph vs AutoGen |
| 아키텍처 패턴 | 파일 기반 vs DB |
| 기술 스택 | Typer vs Click |
| 설계 원칙 | Provider Agnostic |
| 중요 트레이드오프 | 성능 vs 단순성 |

---

## 문서 템플릿

```markdown
## ADR-001: [제목]

### Status
Accepted

### Context
[배경 설명]

요구사항:
- ...
- ...

### Options Considered

| Option | 장점 | 단점 |
|--------|------|------|
| **A** | ... | ... |
| **B** | ... | ... |

### Decision
**[선택] 선택**

### Rationale
1. [이유 1]
2. [이유 2]
3. [이유 3]

### Consequences

**긍정적**:
- ...

**부정적**:
- ...
```

---

## ADR 모음 템플릿

```markdown
# Architecture Decision Records

## Decision Log

| ADR | Decision | Status |
|-----|----------|--------|
| 001 | LangGraph | Accepted |
| 002 | File-based State | Accepted |
| 003 | ... | ... |

---

## ADR-001: ...

[상세]

---

## ADR-002: ...

[상세]
```

---

## 팁

1. **간결하게** - 장황한 설명 X
2. **솔직하게** - 단점도 기록
3. **나중 사람을 위해** - 맥락 충분히
4. **정기적으로** - 중요 결정 시 바로 기록
5. **번호 유지** - 삭제하지 말고 Supersede

---

## 흔한 ADR 주제

```
- 프레임워크 선택 (Web, ORM, CLI 등)
- 데이터 저장 방식 (DB, File, Cache)
- 인증/인가 방식
- API 설계 (REST, GraphQL)
- 배포 전략
- 테스트 전략
- 에러 처리 방식
- 로깅/모니터링
```
